# bundle.py ‚Äî –°–±–æ—Ä—â–∏–∫ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ –≤ Markdown-–±–∞–Ω–¥–ª

–°–∫—Ä–∏–ø—Ç `bundle.py` —Å–æ–±–∏—Ä–∞–µ—Ç —Ñ–∞–π–ª—ã –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –≤ –µ–¥–∏–Ω—ã–π Markdown-–¥–æ–∫—É–º–µ–Ω—Ç  
—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–Ω—ã—Ö –∫–æ–¥–∏—Ä–æ–≤–æ–∫, —Ç–æ—á–Ω—ã–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ –∏ –≥–∏–±–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π.  
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å—Ç—Ä–æ–∫, —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç –±–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞.


## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
pip install charset-normalizer
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –í—ã–≤–µ—Å—Ç–∏ –≤ stdout —Ç–æ–ª—å–∫–æ .cpp –∏ .h —Ñ–∞–π–ª—ã
python bundle.py . -p "*.cpp,*.h"

# –ó–∞–ø–∏—Å–∞—Ç—å –≤—Å—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ src/ –≤ —Ñ–∞–π–ª (–ø–µ—Ä–µ–∑–∞–ø–∏—Å—å)
python bundle.py . -p "src/" -o project.md

# –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –±–∞–Ω–¥–ª—É –±–µ–∑ base64
python bundle.py . -p "*.log" --no-binary-backup "*.log" -a project.md
```

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### –®–∞–±–ª–æ–Ω—ã —Ñ–∞–π–ª–æ–≤ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

- **–®–∞–±–ª–æ–Ω —Å `/` –Ω–∞ –∫–æ–Ω—Ü–µ** ‚Üí **—Ç–æ–ª—å–∫–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏** (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ)  
  –ü—Ä–∏–º–µ—Ä: `tools/`, `docs/api/`

- **–®–∞–±–ª–æ–Ω –±–µ–∑ `/`** ‚Üí **—Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã**  
  –ü—Ä–∏–º–µ—Ä: `*.cpp`, `CMakeLists.txt`, `main`

> üí° –°–æ–≤–µ—Ç: `src/` –¥–æ–±–∞–≤–∏—Ç –≤—Å—é –ø–∞–ø–∫—É `src` —Å–æ –≤—Å–µ–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º,  
> –∞ `src` –¥–æ–±–∞–≤–∏—Ç —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª —Å –∏–º–µ–Ω–µ–º `src` –≤ –∫–æ—Ä–Ω–µ (–µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç).

### –ü–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏

–û–ø—Ü–∏–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è **—Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ**. –ö–∞–∂–¥–∞—è –æ–ø—Ü–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ –Ω–∞–±–æ—Ä—É –ø—É—Ç–µ–π,  
—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É **–ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏** –æ–ø—Ü–∏—è–º–∏.

–ü—Ä–∏–º–µ—Ä:
```bash
python bundle.py . -p "*.txt" --ignore "temp/" -p "legacy/"
```
1. –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ `.txt` —Ñ–∞–π–ª—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ  
2. –ò–∑ –Ω–∏—Ö –∏—Å–∫–ª—é—á–µ–Ω—ã –≤—Å–µ, –Ω–∞—Ö–æ–¥—è—â–∏–µ—Å—è –≤ `temp/`  
3. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤—Å—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `legacy/` (**–∏–≥–Ω–æ—Ä –∏–∑ —à–∞–≥–∞ 2 –Ω–∞ –Ω–µ—ë –Ω–µ –≤–ª–∏—è–µ—Ç!**)

## ‚öôÔ∏è –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –æ–ø—Ü–∏–π

| –û–ø—Ü–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|-----------|
| `-p`, `--patterns` | –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã/–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ —à–∞–±–ª–æ–Ω–∞–º (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑) |
| `--ignore` | –ò—Å–∫–ª—é—á–∏—Ç—å —Ñ–∞–π–ª—ã/–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ —à–∞–±–ª–æ–Ω–∞–º (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑) |
| `--paths-only` | –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø—É—Ç–∏ –±–µ–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ (–ø–æ —à–∞–±–ª–æ–Ω–∞–º) |
| `--encoding` | –ó–∞–¥–∞—Ç—å –∫–æ–¥–∏—Ä–æ–≤–∫—É: `"—à–∞–±–ª–æ–Ω:–∫–æ–¥–∏—Ä–æ–≤–∫–∞"` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `"*.bat:cp866"`) |
| `--no-binary-backup` | –û—Ç–∫–ª—é—á–∏—Ç—å base64-–¥—É–±–ª–∏ –¥–ª—è —à–∞–±–ª–æ–Ω–∞ (—Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ UTF-8 –≤–µ—Ä—Å–∏—é) |
| `-o`, `--output` | –ó–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–∞–π–ª (**–ø–µ—Ä–µ–∑–∞–ø–∏—Å—å**) |
| `-a`, `--append` | –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫ —Ñ–∞–π–ª—É (**–¥–æ–ø–∏—Å—ã–≤–∞–Ω–∏–µ**) |
| (–±–µ–∑ `-o`/`-a`) | –í—ã–≤–æ–¥ –≤ **stdout** |

> ‚ö†Ô∏è `-o` –∏ `-a` –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ. –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã ‚Äî –≤—ã–≤–æ–¥ –≤ `stdout`.

## üìö –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–Ω–¥–ª —Ç–æ–ª—å–∫–æ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤
```bash
python bundle.py . -p "*.cpp,*.h,*.py" -o sources.md
```
‚Üí –°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ `.cpp`, `.h`, `.py` —Ñ–∞–π–ª—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ, –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ `sources.md`.

### 2. –ü–æ–ª–Ω–∞—è —Å–±–æ—Ä–∫–∞ —Å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
```bash
python bundle.py . \
  -p "*" \
  --ignore "__pycache__/,*.tmp,build/,*.log" \
  -o full.md
```
‚Üí –î–æ–±–∞–≤–ª—è–µ—Ç –≤—Å—ë, –∫—Ä–æ–º–µ –∫—ç—à–∞ Python, –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤, —Å–±–æ—Ä–æ—á–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ –ª–æ–≥–æ–≤.

### 3. –°–±–æ—Ä–∫–∞ legacy-–∫–æ–¥–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π
```bash
python bundle.py . \
  -p "legacy/" \
  --encoding "legacy/:cp866" \
  --encoding "legacy/docs/:windows-1251" \
  -o legacy_bundle.md
```
‚Üí –í—Å—è –ø–∞–ø–∫–∞ `legacy/` –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ CP866,  
  –Ω–æ –ø–æ–¥–ø–∞–ø–∫–∞ `legacy/docs/` ‚Äî –∫–∞–∫ Windows-1251.

### 4. –ê—Ä—Ö–∏–≤–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–µ–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
```bash
python bundle.py . \
  -p "src/,config/" \
  --paths-only "src/,config/" \
  -o structure.md
```
‚Üí –í –±–∞–Ω–¥–ª –ø–æ–ø–∞–¥—É—Ç —Ç–æ–ª—å–∫–æ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫, –±–µ–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ.

### 5. –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞
```bash
# –°–Ω–∞—á–∞–ª–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥
python bundle.py . -p "src/" -o project.md

# –ü–æ—Ç–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
python bundle.py . -p "docs/" -a project.md

# –ü–æ—Ç–æ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–±–µ–∑ base64)
python bundle.py . -p "config/*.ini" --no-binary-backup "config/*.ini" -a project.md
```
‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è –≤ `project.md`.

### 6. –í—ã–≤–æ–¥ –≤ –∫–æ–Ω–≤–µ–π–µ—Ä (stdout)
```bash
python bundle.py . -p "*.py" | head -n 50
```
‚Üí –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–ª–∏ –ø–µ—Ä–µ–¥–∞—á–∏ –¥—Ä—É–≥–æ–º—É –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É.

## üìÇ –§–æ—Ä–º–∞—Ç –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –±–∞–Ω–¥–ª–∞

–ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –≤ –≤–∏–¥–µ:

````markdown
---
## `–ø—É—Ç—å/–∫/—Ñ–∞–π–ª—É.cpp`
<!-- bundle:encoding=windows-1251 -->
```cpp
// –ö–æ–¥ –≤ UTF-8 —Å LF-–æ–∫–æ–Ω—á–∞–Ω–∏—è–º–∏
```

## `–ø—É—Ç—å/–∫/—Ñ–∞–π–ª—É.cpp` (original bytes)
```base64
// –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –±–∞–π—Ç—ã (–µ—Å–ª–∏ –Ω–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ --no-binary-backup)
```
````

–î–ª—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:
````markdown
---
## `tools/`
```
# directory
```
````

–î–ª—è `--paths-only`:
````markdown
---
## `debug.log`
```
# path only
```
````

## üõ† –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.6+
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `charset-normalizer` (`pip install charset-normalizer`)

## ‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –ö–∞–∫ —É–∫–∞–∑–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —à–∞–±–ª–æ–Ω–æ–≤?**  
A: –ß–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –≤ –æ–¥–Ω–æ–π –æ–ø—Ü–∏–∏: `-p "*.cpp,tools/"`  
   –ò–ª–∏ –ø–æ–≤—Ç–æ—Ä—è—è –æ–ø—Ü–∏—é: `-p "*.cpp" -p "tools/"`

**Q: –ü–æ—á–µ–º—É –º–æ–π —Ñ–∞–π–ª –Ω–µ –¥–æ–±–∞–≤–∏–ª—Å—è?**  
A: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:  
   - —à–∞–±–ª–æ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–∏–ø—É (—Ñ–∞–π–ª/–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è),  
   - –ø—É—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª–µ–Ω –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞,  
   - –æ–ø—Ü–∏—è —É–∫–∞–∑–∞–Ω–∞ **–¥–æ** `--ignore`, –µ—Å–ª–∏ –≤—ã –µ—ë –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `**` –¥–ª—è —Ä–µ–∫—É—Ä—Å–∏–∏?**  
A: –ù–µ—Ç, —Ä–µ–∫—É—Ä—Å–∏—è –≤–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ –∑–∞–≤–µ—Ä—à–∞—é—â–∏–π `/`.  
   `src/` = `src/**/*` –≤ –¥—Ä—É–≥–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö.

**Q: –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å —Ñ–∞–π–ª–∞–º–∏ –≤ UTF-16?**  
A: –£–∫–∞–∂–∏—Ç–µ —è–≤–Ω–æ: `--encoding="*.bat:utf-16"`

**Q: –ó–∞—á–µ–º –Ω—É–∂–µ–Ω base64-–±–ª–æ–∫, –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç —É–∂–µ –≤ UTF-8?**  
A: –ß—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ **—Ç–æ—á–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å** –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª (–≤–∫–ª—é—á–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫—É, BOM, CRLF –∏ —Ç.–¥.).

**Q: –ú–æ–∂–Ω–æ –ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å base64 –ø–æ–ª–Ω–æ—Å—Ç—å—é?**  
A: –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ ‚Äî –¥–∞, —á–µ—Ä–µ–∑ `--no-binary-backup`.  
   –î–ª—è –±–∏–Ω–∞—Ä–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ ‚Äî –Ω–µ—Ç, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –∫–∞–∫ —Ç–µ–∫—Å—Ç.

**Q: –ü–æ—á–µ–º—É –º–æ–π `.bat`-—Ñ–∞–π–ª –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ –±–∏–Ω–∞—Ä–Ω—ã–π?**  
A: –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω—É–ª–µ–≤–æ–π –±–∞–π—Ç (`\x00`) –∏–ª–∏ –Ω–µ–¥–µ–∫–æ–¥–∏—Ä—É–µ–º—ã–µ —Å–∏–º–≤–æ–ª—ã.  
   –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥–∏—Ä–æ–≤–∫—É ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –æ–Ω –≤ UTF-16. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —É–∫–∞–∂–∏—Ç–µ —è–≤–Ω–æ: `--encoding="*.bat:utf-16"`.

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è ¬´–∫–∞–∫ –µ—Å—Ç—å¬ª, –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –≥–∞—Ä–∞–Ω—Ç–∏–π.  
–í—ã –º–æ–∂–µ—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –∏–∑–º–µ–Ω—è—Ç—å –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å –µ–≥–æ –≤ —Å–≤–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.

## üôå –ê–≤—Ç–æ—Ä

–î–º–∏—Ç—Ä–∏–π "dilukhin" –ò–ª—é—Ö–∏–Ω